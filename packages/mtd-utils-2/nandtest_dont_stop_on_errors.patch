--- mtd-utils-orig/nandtest.c	2009-02-03 19:03:08.000000000 -0800
+++ mtd-utils/nandtest.c	2010-05-06 09:39:12.878144222 -0700
@@ -71,7 +71,7 @@
 	if (len < meminfo.erasesize) {
 		printf("\n");
 		fprintf(stderr, "Short write (%d bytes)\n", len);
-		exit(1);
+		return 1;
 	}
 
 	printf("\r%08x: reading...", (unsigned)ofs);
@@ -84,14 +84,14 @@
 			fprintf(stderr, "Short read (%d bytes)\n", len);
 		else
 			perror("read");
-		exit(1);
+		return 1;
 	}
 		
 	if (ioctl(fd, ECCGETSTATS, &newstats)) {
 		printf("\n");
 		perror("ECCGETSTATS");
 		close(fd);
-		exit(1);
+		return 1;
 	}
 
 	if (newstats.corrected > oldstats.corrected) {
@@ -103,7 +103,7 @@
 		oldstats.corrected = newstats.corrected;
 	}
 	if (len < meminfo.erasesize)
-		exit(1);
+		return 1;
 
 	printf("\r%08x: checking...", (unsigned)ofs);
 	fflush(stdout);
@@ -111,12 +111,15 @@
 	if (memcmp(data, rbuf, meminfo.erasesize)) {
 		printf("\n");
 		fprintf(stderr, "compare failed. seed %d\n", seed);
-		for (i=0; i<meminfo.erasesize; i++) {
-			if (data[i] != rbuf[i])
-				printf("Byte 0x%x is %02x should be %02x\n",
-				       i, rbuf[i], data[i]);
+		int j;
+		for (i=0, j=0; i<meminfo.erasesize && j<5; i++) {
+			if (data[i] != rbuf[i]) {
+				j++;
+				fprintf(stderr, "Byte 0x%x is %02x and should be %02x\n",
+					i, rbuf[i], data[i]);
+			}
 		}
-		exit(1);
+		return 1;
 	}
 	return 0;
 }
@@ -266,7 +269,7 @@
 						fprintf(stderr, "Short read (%d bytes)\n", len);
 					else
 						perror("read");
-					exit(1);
+					return 1;
 				}
 			}
 			if (erase_and_write(test_ofs, wbuf, rbuf))
