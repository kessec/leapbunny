#!/bin/sh

# switch Didj USB from mass-storage to ethernet-over-usb

# uninstall mass_storage driver if loaded
lsmod | grep -q g_file_storage
RESULT=$?
if [ "$RESULT" = "0" ]; then

    # mount partitions if possible
    usbctl -d mass_storage -a disable
    RESULT=$?
    if [ ! "$RESULT" = "0" ]; then
        echo "Ethernet driver not loaded, You may still be mounted to the PC"
        exit 1;
    fi

    # stop mass storage driver
    /etc/init.d/mass_storage stop
fi

# install ethernet driver if not loaded
lsmod | grep -q g_ether
RESULT=$?
if [ ! "$RESULT" = "0" ]; then
    /etc/init.d/usbether start
fi

#  install nfs driver if not loaded
lsmod | grep -q nfs
RESULT=$?
if [ ! "$RESULT" = "0" ]; then
    /etc/init.d/nfs start
fi

# start telnet server if not running
ps au | grep -q telnetd
RESULT=$?
if [ ! "$RESULT" = "0" ]; then
    /etc/init.d/telnetd start
fi
