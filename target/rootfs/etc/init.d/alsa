#!/bin/sh
#
# Determine which audio codec (if any) we have and load the appropriate Alsa
# SoC board driver

case "$1" in
	start)
		i2c-ctl /dev/i2c-0 r 0x95 0x01 2 > /dev/null
		if [ "$?" = "0" ]; then
			logger -s -t "Emerald Base" -p local4.notice  "found Cirrus Logic codec"
			modprobe snd-soc-didj-cs43l22
			exit 0
		fi
		
		i2c-ctl /dev/i2c-0 r 0xcd 0x01 2 > /dev/null
		if [ "$?" = "0" ]; then
			logger -s -t "Emerald Base" -p local4.notice  "found LFP100 codec"
			modprobe snd-soc-didj-lfp100
			exit 0
		fi
		
		logger -s -t "Emerald Base" -p local4.notice  "Error: no codec found"
		exit 1
		;;
	stop)
		if [ -e /sys/module/snd_soc_didj_cs43l22 ]; then
			modprobe -r snd-soc-didj-cs43l22
		elif [ -e snd-soc-didj-lfp100 ]; then
			modprobe -r snd-soc-didj-lfp100
		fi
		;;
	restart)
		$0 stop
		$0 start
		;;
	*)
		echo "Usage: $0 {start|stop|restart}"
		exit 1
		;;
esac

exit 0
